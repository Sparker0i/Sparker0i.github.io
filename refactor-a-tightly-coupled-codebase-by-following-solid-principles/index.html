<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Transforming an Old Codebase for Better Modularity and Security with SOLID Principles and Design patterns"><title>Refactor a tightly coupled codebase by following SOLID Principles</title><link rel=canonical href=https://blog.sparker0i.me/refactor-a-tightly-coupled-codebase-by-following-solid-principles/><link rel=stylesheet href=/scss/style.min.86591c898bd806857815fbb8c47e8d3fed97c133b78e83d9bfc27b164dd0aa2b.css><meta property='og:title' content="Refactor a tightly coupled codebase by following SOLID Principles"><meta property='og:description' content="Transforming an Old Codebase for Better Modularity and Security with SOLID Principles and Design patterns"><meta property='og:url' content='https://blog.sparker0i.me/refactor-a-tightly-coupled-codebase-by-following-solid-principles/'><meta property='og:site_name' content="Sparker0i's Blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='SOLID Principles'><meta property='article:tag' content='Clean Code'><meta property='article:tag' content='Refactor'><meta property='article:tag' content='Software Architecture'><meta property='article:published_time' content='2024-08-06T22:01:48+00:00'><meta property='article:modified_time' content='2024-08-06T22:02:48+00:00'><meta property='og:image' content='https://blog.sparker0i.me/refactor-a-tightly-coupled-codebase-by-following-solid-principles/66b29d4c63629cc69724f054.png'><meta name=twitter:title content="Refactor a tightly coupled codebase by following SOLID Principles"><meta name=twitter:description content="Transforming an Old Codebase for Better Modularity and Security with SOLID Principles and Design patterns"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://blog.sparker0i.me/refactor-a-tightly-coupled-codebase-by-following-solid-principles/66b29d4c63629cc69724f054.png'><link rel="shortcut icon" href=/favicon.png><script async src="https://www.googletagmanager.com/gtag/js?id=G-B20G7JM0X8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-B20G7JM0X8")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/sparker0i_hu_693dc16bb266ace6.jpg width=300 height=301 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ðŸ˜Ž</span></figure><div class=site-meta><h1 class=site-name><a href=/>Sparker0i's Blog</a></h1><h2 class=site-description>I blog about coding, tech, AI, cricket and other personal hobbies too.</h2></div></header><ol class=menu-social><li><a href=https://github.com/Sparker0i target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/sparker0i target=_blank title=LinkedIn rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-linkedin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 10-4 0"/><path d="M3 7a4 4 0 014-4h10a4 4 0 014 4v10a4 4 0 01-4 4H7a4 4 0 01-4-4z"/></svg></a></li><li><a href=https://steamcommunity.com/id/Sparker0i target=_blank title=Steam rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-steam"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16.5 5a4.5 4.5.0 11-.653 8.953L11.5 16.962V17a3 3 0 01-2.824 3H8.5a3 3 0 01-2.94-2.402L3 16.5V13l3.51 1.755a2.989 2.989.0 012.834-.635l2.727-3.818A4.5 4.5.0 0116.5 5z"/><circle cx="16.5" cy="9.5" r="1" fill="currentColor"/></svg></a></li><li><a href=https://x.com/Sparker0i target=_blank title=Twitter rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-x"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#background>Background</a></li><li><a href=#inspiration>Inspiration</a></li><li><a href=#breakdown>Breakdown</a></li><li><a href=#request-package>Request Package</a><ol><li><a href=#method>Method</a></li><li><a href=#body>Body</a></li><li><a href=#authentication>Authentication</a></li><li><a href=#api-request>API Request</a></li><li><a href=#api-request-builder>API Request Builder</a></li><li><a href=#api-response>API Response</a></li></ol></li><li><a href=#client>Client</a><ol><li><a href=#client-library>Client Library</a></li><li><a href=#authentication-wrapper>Authentication Wrapper</a></li><li><a href=#body-parser>Body Parser</a></li><li><a href=#client-implementation>Client Implementation</a></li></ol></li><li><a href=#ensure-stability-of-api-package>Ensure stability of API package</a></li><li><a href=#using-the-client>Using the client</a></li><li><a href=#adherence-to-solid-principles>Adherence to SOLID Principles</a><ol><li><a href=#single-responsibility-principle-srp><strong>S</strong>ingle Responsibility Principle (SRP)</a></li><li><a href=#openclosed-principle-ocp><strong>O</strong>pen/Closed Principle (OCP)</a></li><li><a href=#liskov-substitution-principle-lsp><strong>L</strong>iskov Substitution Principle (LSP)</a></li><li><a href=#interface-segregation-principle-isp><strong>I</strong>nterface Segregation Principle (ISP)</a></li><li><a href=#dependency-inversion-principle-dip><strong>D</strong>ependency Inversion Principle (DIP)</a></li></ol></li><li><a href=#conclusion>Conclusion</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/refactor-a-tightly-coupled-codebase-by-following-solid-principles/><img src=/refactor-a-tightly-coupled-codebase-by-following-solid-principles/66b29d4c63629cc69724f054_hu_d288ff6e4c7970a6.png srcset="/refactor-a-tightly-coupled-codebase-by-following-solid-principles/66b29d4c63629cc69724f054_hu_d288ff6e4c7970a6.png 800w, /refactor-a-tightly-coupled-codebase-by-following-solid-principles/66b29d4c63629cc69724f054_hu_c486bff6ce2be30d.png 1600w" width=800 height=457 loading=lazy alt="Featured image of post Refactor a tightly coupled codebase by following SOLID Principles"></a></div><div class=article-details><header class=article-category><a href=/categories/clean-code/ style=background-color:#0073c0;color:#fff>Clean Code
</a><a href=/categories/software-architecture/ style=background-color:#1d00c0;color:#fff>Software Architecture</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/refactor-a-tightly-coupled-codebase-by-following-solid-principles/>Refactor a tightly coupled codebase by following SOLID Principles</a></h2><h3 class=article-subtitle>Transforming an Old Codebase for Better Modularity and Security with SOLID Principles and Design patterns</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2024-08-06T22:01:48Z>Aug 06, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>16 minute read</time></div></footer></div></header><section class=article-content><p>We&rsquo;ve been developing an AI-enabled data engineering product at our company, using Scala as the core programming language. We also utilize Scala-related frameworks like Spark and Play to power various components. Recently, we conducted a vulnerability scan on our applications and discovered numerous security issues. The root cause was that we hadn&rsquo;t updated our libraries in over three years.</p><p>During this period, Scala underwent a major release and introduced its first Long-Term Support (LTS) version. Alongside these updates, our codebase had accumulated significant technical debt, providing us with an opportunity to address longstanding inefficiencies.</p><h2 id=background>Background</h2><p>We had been using the <a class=link href=https://github.com/scalaj/scalaj-http target=_blank rel=noopener><code>scalaj-http</code></a> library for making HTTP calls in Scala. However, this library had reached its end-of-life (EOL) status over two years ago and was no longer receiving updates.</p><p>This is a small snippet of our class which defines the methods making HTTP calls:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>def</span> <span class=n>makePostCall</span><span class=o>(</span><span class=n>url</span><span class=k>:</span> <span class=kt>String</span><span class=o>,</span> <span class=n>body</span><span class=k>:</span> <span class=kt>String</span><span class=o>,</span> <span class=n>authToken</span><span class=k>:</span> <span class=kt>String</span><span class=o>)</span><span class=k>:</span> <span class=o>(</span><span class=kt>Int</span><span class=o>,</span> <span class=kt>JsValue</span><span class=o>)</span> <span class=k>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>println</span><span class=o>(</span><span class=s>&#34;url: &#34;</span><span class=o>+</span><span class=n>url</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=n>println</span><span class=o>(</span><span class=s>&#34;body: &#34;</span><span class=o>+</span><span class=n>body</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=n>res</span> <span class=k>=</span> <span class=nc>Http</span><span class=o>(</span><span class=n>url</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=o>.</span><span class=n>header</span><span class=o>(</span><span class=s>&#34;Content-Type&#34;</span><span class=o>,</span> <span class=s>&#34;application/json&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=o>.</span><span class=n>header</span><span class=o>(</span><span class=s>&#34;Authorization&#34;</span><span class=o>,</span> <span class=s>s&#34;Bearer </span><span class=si>$authToken</span><span class=s>&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=o>.</span><span class=n>header</span><span class=o>(</span><span class=s>&#34;Charset&#34;</span><span class=o>,</span> <span class=s>&#34;UTF-8&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=o>.</span><span class=n>option</span><span class=o>(</span><span class=nc>HttpOptions</span><span class=o>.</span><span class=n>readTimeout</span><span class=o>(</span><span class=mi>100000000</span><span class=o>))</span>
</span></span><span class=line><span class=cl>      <span class=o>.</span><span class=n>option</span><span class=o>(</span><span class=nc>HttpOptions</span><span class=o>.</span><span class=n>connTimeout</span><span class=o>(</span><span class=mi>100000000</span><span class=o>))</span>
</span></span><span class=line><span class=cl>      <span class=o>.</span><span class=n>postData</span><span class=o>(</span><span class=n>body</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=o>.</span><span class=n>asString</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=n>code</span> <span class=k>=</span> <span class=n>res</span><span class=o>.</span><span class=n>code</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=n>response</span> <span class=k>=</span> <span class=nc>Json</span><span class=o>.</span><span class=n>parse</span><span class=o>(</span><span class=n>res</span><span class=o>.</span><span class=n>body</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>(</span><span class=n>code</span><span class=o>,</span> <span class=n>response</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=n>makeGetCall</span><span class=o>(</span><span class=n>url</span><span class=k>:</span> <span class=kt>String</span><span class=o>,</span> <span class=n>authToken</span><span class=k>:</span> <span class=kt>String</span><span class=o>)</span><span class=k>:</span> <span class=o>(</span><span class=kt>Int</span><span class=o>,</span> <span class=kt>JsValue</span><span class=o>)</span> <span class=k>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>println</span><span class=o>(</span><span class=s>&#34;url: &#34;</span><span class=o>+</span><span class=n>url</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=n>res</span> <span class=k>=</span> <span class=nc>Http</span><span class=o>(</span><span class=n>url</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=o>.</span><span class=n>header</span><span class=o>(</span><span class=s>&#34;Content-Type&#34;</span><span class=o>,</span> <span class=s>&#34;application/json&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=o>.</span><span class=n>header</span><span class=o>(</span><span class=s>&#34;Authorization&#34;</span><span class=o>,</span> <span class=s>s&#34;Bearer </span><span class=si>$authToken</span><span class=s>&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=o>.</span><span class=n>header</span><span class=o>(</span><span class=s>&#34;Charset&#34;</span><span class=o>,</span> <span class=s>&#34;UTF-8&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=o>.</span><span class=n>option</span><span class=o>(</span><span class=nc>HttpOptions</span><span class=o>.</span><span class=n>readTimeout</span><span class=o>(</span><span class=mi>100000000</span><span class=o>))</span>
</span></span><span class=line><span class=cl>      <span class=o>.</span><span class=n>option</span><span class=o>(</span><span class=nc>HttpOptions</span><span class=o>.</span><span class=n>connTimeout</span><span class=o>(</span><span class=mi>100000000</span><span class=o>))</span>
</span></span><span class=line><span class=cl>      <span class=o>.</span><span class=n>asString</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=n>code</span> <span class=k>=</span> <span class=n>res</span><span class=o>.</span><span class=n>code</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=n>response</span> <span class=k>=</span> <span class=nc>Json</span><span class=o>.</span><span class=n>parse</span><span class=o>(</span><span class=n>res</span><span class=o>.</span><span class=n>body</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>(</span><span class=n>code</span><span class=o>,</span> <span class=n>response</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// More methods for more HTTP types.
</span></span></span></code></pre></td></tr></table></div></div><p>With our existing code base, there was no scope of any modification. It had a lot of limitations:</p><ol><li>HTTP call functions were hardcoded.</li><li>Headers were not modifiable</li><li>Authentication was limited to Bearer tokens</li><li>The request body format was restricted to JSON</li><li>HTTP methods could not be easily altered.</li></ol><p>These limitations affected not only our HTTP class but also other classes that relied on it. With the EOL of <code>scalaj-http</code>, we needed to refactor our codebase significantly.</p><h2 id=inspiration>Inspiration</h2><p><img src=/refactor-a-tightly-coupled-codebase-by-following-solid-principles/66b29d4c63629cc69724f054_f2e3b482-7e1b-45d3-a23e-4986ed15fcc6.jpeg width=3014 height=1350 srcset="/refactor-a-tightly-coupled-codebase-by-following-solid-principles/66b29d4c63629cc69724f054_f2e3b482-7e1b-45d3-a23e-4986ed15fcc6_hu_c67e156663a53662.jpeg 480w, /refactor-a-tightly-coupled-codebase-by-following-solid-principles/66b29d4c63629cc69724f054_f2e3b482-7e1b-45d3-a23e-4986ed15fcc6_hu_5cb423a2699cd6d6.jpeg 1024w" loading=lazy alt="A sample REST API Client" class=gallery-image data-flex-grow=223 data-flex-basis=535px></p><p>Many software developers and testers use REST API clients to test API endpoints. Various REST API clients exist, and the one you see above is Bruno - One of the only REST clients that meet my org&rsquo;s stringent IT Security Standards.</p><p>The flexibility of API clients - allowing for different HTTP methods, body types, and authentication mechanisms - is crucial. This adaptability is possible because these clients are not hardcoded, unlike our previous implementation. Therefore, in our refactoring, we aimed to make our code modular and adhere to known design patterns and SOLID principles.</p><h2 id=breakdown>Breakdown</h2><p>In our previous implementation, constructing the HTTP request and making the call were done within a single file. This approach meant that any modification required changes across multiple classes, leading to tight coupling.</p><p>To resolve this, we decided to separate our API package into three subpackages:</p><ol><li><code>request</code></li><li><code>client</code></li><li><code>apps</code></li></ol><p>The <code>request</code> and <code>client</code> components are designed to be loosely coupled. This separation ensures that changes in one part, such as switching to a different client library, require minimal modifications elsewhere in the code. Ideally, only a single line should need updating to change the client library used throughout the program. Classes inside <code>apps</code> would use the client to execute business processes by making the HTTP calls.</p><h2 id=request-package>Request Package</h2><p>To construct an HTTP request, there are five fundamental components:</p><ol><li>URL</li><li>Headers</li><li>HTTP Method</li><li>Body</li><li>Authentication</li></ol><p>It&rsquo;s a widely accepted convention that the URL is a <code>String</code>, while headers are represented as a <code>HashMap</code> with <code>String</code> keys and values.</p><p>The elements that can vary between HTTP requests are the Method, Body, and Authentication.</p><h3 id=method>Method</h3><p>In this initial implementation of the Request package, I&rsquo;ve chosen to support the most commonly used HTTP methods:</p><ol><li>GET</li><li>POST</li><li>PUT</li><li>DELETE</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>trait</span> <span class=nc>ApiMethod</span>        <span class=c1>// trait is the equivalent for interface in OOP langugaes
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=k>object</span> <span class=nc>DELETE</span> <span class=k>extends</span> <span class=nc>ApiMethod</span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=k>object</span> <span class=nc>GET</span> <span class=k>extends</span> <span class=nc>ApiMethod</span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=k>object</span> <span class=nc>POST</span> <span class=k>extends</span> <span class=nc>ApiMethod</span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=k>object</span> <span class=nc>PUT</span> <span class=k>extends</span> <span class=nc>ApiMethod</span>
</span></span></code></pre></td></tr></table></div></div><p>To implement these, I use a Scala-specific paradigm called <a class=link href=https://docs.scala-lang.org/overviews/scala-book/case-objects.html target=_blank rel=noopener><code>Case Object</code></a>, which aligns with the <a class=link href=https://sourcemaking.com/design_patterns/singleton target=_blank rel=noopener>Singleton design pattern</a>. This approach is similar to enums in other programming languages.</p><h3 id=body>Body</h3><p>For the body of HTTP requests, I will support four types:</p><ol><li>JSON</li><li>XML</li><li>Binary</li><li>FormURLEncoded</li></ol><p>To manage these, I created an interface (<code>ApiBody</code>) that specifies two methods: <code>contentType</code> and <code>content</code>. Each respective class will have a default constructor that includes a variable representing the content we intend to send.</p><p>The <code>contentType</code> method will return the MIME type, such as <code>application/json</code> or <code>application/xml</code>. The <code>content</code> method will convert the body content into a byte array. The choice of a byte array is deliberate; while JSON and XML content can often be represented as a string, binary data cannot. By converting all types into a byte array, we provide a consistent interface for later client implementations.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>trait</span> <span class=nc>ApiBody</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=n>contentType</span><span class=k>:</span> <span class=kt>String</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=n>content</span><span class=k>:</span> <span class=kt>Array</span><span class=o>[</span><span class=kt>Byte</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=k>class</span> <span class=nc>JsonBody</span><span class=o>(</span><span class=n>json</span><span class=k>:</span> <span class=kt>String</span><span class=o>)</span> <span class=k>extends</span> <span class=nc>ApiBody</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>override</span> <span class=k>def</span> <span class=n>contentType</span><span class=k>:</span> <span class=kt>String</span> <span class=o>=</span> <span class=s>&#34;application/json&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>override</span> <span class=k>def</span> <span class=n>content</span><span class=k>:</span> <span class=kt>Array</span><span class=o>[</span><span class=kt>Byte</span><span class=o>]</span> <span class=k>=</span> <span class=n>json</span><span class=o>.</span><span class=n>getBytes</span><span class=o>(</span><span class=s>&#34;UTF-8&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=k>class</span> <span class=nc>XmlBody</span><span class=o>(</span><span class=n>xml</span><span class=k>:</span> <span class=kt>String</span><span class=o>)</span> <span class=k>extends</span> <span class=nc>ApiBody</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>override</span> <span class=k>def</span> <span class=n>contentType</span><span class=k>:</span> <span class=kt>String</span> <span class=o>=</span> <span class=s>&#34;application/xml&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>override</span> <span class=k>def</span> <span class=n>content</span><span class=k>:</span> <span class=kt>Array</span><span class=o>[</span><span class=kt>Byte</span><span class=o>]</span> <span class=k>=</span> <span class=n>xml</span><span class=o>.</span><span class=n>getBytes</span><span class=o>(</span><span class=s>&#34;UTF-8&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=k>class</span> <span class=nc>FormUrlEncodedBody</span><span class=o>(</span><span class=n>formData</span><span class=k>:</span> <span class=kt>Map</span><span class=o>[</span><span class=kt>String</span>, <span class=kt>String</span><span class=o>])</span> <span class=k>extends</span> <span class=nc>ApiBody</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>override</span> <span class=k>def</span> <span class=n>contentType</span><span class=k>:</span> <span class=kt>String</span> <span class=o>=</span> <span class=s>&#34;application/x-www-form-urlencoded&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>override</span> <span class=k>def</span> <span class=n>content</span><span class=k>:</span> <span class=kt>Array</span><span class=o>[</span><span class=kt>Byte</span><span class=o>]</span> <span class=k>=</span> <span class=n>formData</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>map</span><span class=o>(</span><span class=n>e</span> <span class=k>=&gt;</span> <span class=n>java</span><span class=o>.</span><span class=n>net</span><span class=o>.</span><span class=nc>URLEncoder</span><span class=o>.</span><span class=n>encode</span><span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=n>_1</span><span class=o>,</span> <span class=s>&#34;UTF-8&#34;</span><span class=o>)</span> <span class=o>+</span> <span class=s>&#34;=&#34;</span> <span class=o>+</span> <span class=n>java</span><span class=o>.</span><span class=n>net</span><span class=o>.</span><span class=nc>URLEncoder</span><span class=o>.</span><span class=n>encode</span><span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=n>_2</span><span class=o>,</span> <span class=s>&#34;UTF-8&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>mkString</span><span class=o>(</span><span class=s>&#34;&amp;&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>getBytes</span><span class=o>(</span><span class=s>&#34;UTF-8&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=k>class</span> <span class=nc>BinaryBody</span><span class=o>(</span><span class=n>data</span><span class=k>:</span> <span class=kt>Array</span><span class=o>[</span><span class=kt>Byte</span><span class=o>])</span> <span class=k>extends</span> <span class=nc>ApiBody</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>override</span> <span class=k>def</span> <span class=n>contentType</span><span class=k>:</span> <span class=kt>String</span> <span class=o>=</span> <span class=s>&#34;application/octet-stream&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>override</span> <span class=k>def</span> <span class=n>content</span><span class=k>:</span> <span class=kt>Array</span><span class=o>[</span><span class=kt>Byte</span><span class=o>]</span> <span class=k>=</span> <span class=n>data</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=authentication>Authentication</h3><p>We will implement two common types of authentication:</p><ol><li>Token based authentication</li><li>Basic authentication (user/password)</li></ol><p>The plan was to use the same approach as with Body and Method, by defining an interface and corresponding classes. However, thereâ€™s a challenge: different client libraries may handle authentication in unique ways. Since the Request package must remain unaware of the Client package&rsquo;s specifics, a direct implementation isnâ€™t feasible.</p><p>One potential solution is to use headers since they can be represented as a key-value map. This method works for basic and token-based authentication but fails for more complex mechanisms, such as GitHub API or AWS S3 SDK with v4 signature. These mechanisms often require access to the request body to generate appropriate headers.</p><p>In my implementation, I have kept Body and Authentication separate, and I intend to maintain that separation. The solution involves creating an interface and corresponding classes for authentication types, along with a wrapper that encapsulates all authentication mechanisms. This wrapper will then be implemented by the Client to execute the HTTP call.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>trait</span> <span class=nc>AuthRequestProvider</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=n>addBearerToken</span><span class=o>(</span><span class=n>token</span><span class=k>:</span> <span class=kt>String</span><span class=o>)</span><span class=k>:</span> <span class=kt>Unit</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=n>addBasicAuth</span><span class=o>(</span><span class=n>username</span><span class=k>:</span> <span class=kt>String</span><span class=o>,</span> <span class=n>password</span><span class=k>:</span> <span class=kt>String</span><span class=o>)</span><span class=k>:</span> <span class=kt>Unit</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>trait</span> <span class=nc>ApiAuth</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=n>applyTo</span><span class=o>(</span><span class=n>request</span><span class=k>:</span> <span class=kt>AuthRequestProvider</span><span class=o>)</span><span class=k>:</span> <span class=kt>Unit</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=k>class</span> <span class=nc>BasicAuth</span><span class=o>(</span><span class=n>username</span><span class=k>:</span> <span class=kt>String</span><span class=o>,</span> <span class=n>password</span><span class=k>:</span> <span class=kt>String</span><span class=o>)</span> <span class=k>extends</span> <span class=nc>ApiAuth</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>override</span> <span class=k>def</span> <span class=n>applyTo</span><span class=o>(</span><span class=n>request</span><span class=k>:</span> <span class=kt>AuthRequestProvider</span><span class=o>)</span><span class=k>:</span> <span class=kt>Unit</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>request</span><span class=o>.</span><span class=n>addBasicAuth</span><span class=o>(</span><span class=n>username</span><span class=o>,</span> <span class=n>password</span><span class=o>)</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=k>class</span> <span class=nc>TokenAuth</span><span class=o>(</span><span class=n>token</span><span class=k>:</span> <span class=kt>String</span><span class=o>)</span> <span class=k>extends</span> <span class=nc>ApiAuth</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>override</span> <span class=k>def</span> <span class=n>applyTo</span><span class=o>(</span><span class=n>request</span><span class=k>:</span> <span class=kt>AuthRequestProvider</span><span class=o>)</span><span class=k>:</span> <span class=kt>Unit</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>request</span><span class=o>.</span><span class=n>addBearerToken</span><span class=o>(</span><span class=n>token</span><span class=o>)</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The implementation of the <code>AuthRequestProvider</code> in the Client package will be discussed in a subsequent section.</p><h3 id=api-request>API Request</h3><p>With the basics of building an HTTP Request covered, the next step is to create a class representing our <code>ApiRequest</code>. This class will be used by the client to execute the actual HTTP call.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>protected</span><span class=o>[</span><span class=kt>api</span><span class=o>]</span> <span class=k>case</span> <span class=k>class</span> <span class=nc>ApiRequest</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                        <span class=n>method</span><span class=k>:</span> <span class=kt>ApiMethod</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>url</span><span class=k>:</span> <span class=kt>String</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>body</span><span class=k>:</span> <span class=kt>Option</span><span class=o>[</span><span class=kt>ApiBody</span><span class=o>]</span> <span class=k>=</span> <span class=nc>None</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>headers</span><span class=k>:</span> <span class=kt>Map</span><span class=o>[</span><span class=kt>String</span>, <span class=kt>String</span><span class=o>]</span> <span class=k>=</span> <span class=nc>Map</span><span class=o>.</span><span class=n>empty</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>authentication</span><span class=k>:</span> <span class=kt>Option</span><span class=o>[</span><span class=kt>ApiAuth</span><span class=o>]</span> <span class=k>=</span> <span class=nc>None</span>
</span></span><span class=line><span class=cl>                      <span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>In this class, the <code>Method</code> and <code>URL</code> are mandatory components for making an HTTP call. While headers are optional, they are represented using a <code>Map</code> data type, so no dedicated class is necessary. The <code>Body</code> and <code>Authentication</code> components are also optional and are encapsulated using the <a class=link href=https://docs.scala-lang.org/overviews/collections-2.13/conversion-between-option-and-the-collections.html#inner-main target=_blank rel=noopener><code>Option</code> wrapper</a>. If a component is absent, it will be represented as <code>None</code>; if present, it will be enclosed within a <code>Some</code> object.</p><p>The <code>protected[api]</code> modifier on the case class restricts its instantiation to within the <code>api</code> package, which includes both the request and client sub-packages. This ensures that downstream classes cannot create substandard <code>ApiRequest</code> instances, maintaining the integrity of our API implementation.</p><h3 id=api-request-builder>API Request Builder</h3><p>Downstream classes should use the <code>ApiRequestBuilder</code> to create an <code>ApiRequest</code> object, which they can then pass to the client for making the HTTP call. This implementation follows the <a class=link href=https://sourcemaking.com/design_patterns/builder target=_blank rel=noopener>Builder design pattern</a>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>case</span> <span class=k>class</span> <span class=nc>ApiRequestBuilder</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                               <span class=k>private</span> <span class=k>val</span> <span class=n>method</span><span class=k>:</span> <span class=kt>Option</span><span class=o>[</span><span class=kt>ApiMethod</span><span class=o>]</span> <span class=k>=</span> <span class=nc>Some</span><span class=o>(</span><span class=nc>GET</span><span class=o>),</span>
</span></span><span class=line><span class=cl>                               <span class=k>private</span> <span class=k>val</span> <span class=n>url</span><span class=k>:</span> <span class=kt>String</span> <span class=o>=</span> <span class=s>&#34;&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                               <span class=k>private</span> <span class=k>val</span> <span class=n>body</span><span class=k>:</span> <span class=kt>Option</span><span class=o>[</span><span class=kt>ApiBody</span><span class=o>]</span> <span class=k>=</span> <span class=nc>None</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                               <span class=k>private</span> <span class=k>val</span> <span class=n>headers</span><span class=k>:</span> <span class=kt>Map</span><span class=o>[</span><span class=kt>String</span>, <span class=kt>String</span><span class=o>]</span> <span class=k>=</span> <span class=nc>Map</span><span class=o>(),</span>
</span></span><span class=line><span class=cl>                               <span class=k>private</span> <span class=k>val</span> <span class=n>authentication</span><span class=k>:</span> <span class=kt>Option</span><span class=o>[</span><span class=kt>ApiAuth</span><span class=o>]</span> <span class=k>=</span> <span class=nc>None</span>
</span></span><span class=line><span class=cl>                             <span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=n>withMethod</span><span class=o>(</span><span class=n>method</span><span class=k>:</span> <span class=kt>ApiMethod</span><span class=o>)</span><span class=k>:</span> <span class=kt>ApiRequestBuilder</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=n>copy</span><span class=o>(</span><span class=n>method</span> <span class=k>=</span> <span class=nc>Some</span><span class=o>(</span><span class=n>method</span><span class=o>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=n>withUrl</span><span class=o>(</span><span class=n>url</span><span class=k>:</span> <span class=kt>String</span><span class=o>)</span><span class=k>:</span> <span class=kt>ApiRequestBuilder</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=n>copy</span><span class=o>(</span><span class=n>url</span> <span class=k>=</span> <span class=n>url</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=n>withBody</span><span class=o>(</span><span class=n>body</span><span class=k>:</span> <span class=kt>ApiBody</span><span class=o>)</span><span class=k>:</span> <span class=kt>ApiRequestBuilder</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=n>copy</span><span class=o>(</span><span class=n>body</span> <span class=k>=</span> <span class=nc>Some</span><span class=o>(</span><span class=n>body</span><span class=o>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=n>withHeaders</span><span class=o>(</span><span class=n>headers</span><span class=k>:</span> <span class=kt>Map</span><span class=o>[</span><span class=kt>String</span>, <span class=kt>String</span><span class=o>])</span><span class=k>:</span> <span class=kt>ApiRequestBuilder</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=n>copy</span><span class=o>(</span><span class=n>headers</span> <span class=k>=</span> <span class=n>headers</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=n>addHeader</span><span class=o>(</span><span class=n>key</span><span class=k>:</span> <span class=kt>String</span><span class=o>,</span> <span class=n>value</span><span class=k>:</span> <span class=kt>String</span><span class=o>)</span><span class=k>:</span> <span class=kt>ApiRequestBuilder</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=n>copy</span><span class=o>(</span><span class=n>headers</span> <span class=k>=</span> <span class=n>headers</span> <span class=o>+</span> <span class=o>(</span><span class=n>key</span> <span class=o>-&gt;</span> <span class=n>value</span><span class=o>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=n>withAuthentication</span><span class=o>(</span><span class=n>auth</span><span class=k>:</span> <span class=kt>ApiAuth</span><span class=o>)</span><span class=k>:</span> <span class=kt>ApiRequestBuilder</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=n>copy</span><span class=o>(</span><span class=n>authentication</span> <span class=k>=</span> <span class=nc>Some</span><span class=o>(</span><span class=n>auth</span><span class=o>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=n>build</span><span class=o>()</span><span class=k>:</span> <span class=kt>ApiRequest</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>method</span><span class=o>.</span><span class=n>isEmpty</span> <span class=o>||</span> <span class=n>url</span><span class=o>.</span><span class=n>isEmpty</span><span class=o>)</span> <span class=k>throw</span> <span class=k>new</span> <span class=nc>IllegalStateException</span><span class=o>(</span><span class=s>&#34;Method and URL cannot be empty&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=nc>ApiRequest</span><span class=o>(</span><span class=n>method</span><span class=o>.</span><span class=n>get</span><span class=o>,</span> <span class=n>url</span><span class=o>,</span> <span class=n>body</span><span class=o>,</span> <span class=n>headers</span><span class=o>,</span> <span class=n>authentication</span><span class=o>)</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The usage is straightforward: methods like <code>withUrl</code>, <code>withHeaders</code> and others allow you to configure your request. The <code>build()</code> method then produces the <code>ApiRequest</code> object, which can be passed to the client from downstream classes.</p><h3 id=api-response>API Response</h3><p>When an HTTP request is made, a response is received, which can influence decisions within the application. The <code>APIResponse</code> case class encapsulates this response, including the HTTP response code, response body, and response headers.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>case</span> <span class=k>class</span> <span class=nc>ApiResponse</span><span class=o>(</span><span class=n>code</span><span class=k>:</span> <span class=kt>Int</span><span class=o>,</span> <span class=n>body</span><span class=k>:</span> <span class=kt>ApiBody</span><span class=o>,</span> <span class=n>headers</span><span class=k>:</span> <span class=kt>Map</span><span class=o>[</span><span class=kt>String</span>, <span class=kt>String</span><span class=o>]</span> <span class=k>=</span> <span class=nc>Map</span><span class=o>())</span>
</span></span></code></pre></td></tr></table></div></div><p>For the response body, we utilize the same <code>ApiBody</code> interface as for the request body, maintaining consistency across request and response handling.</p><h2 id=client>Client</h2><p>With our Request package established, we now focus on the client responsible for making the actual HTTP call. The client will be defined as an interface with a single method, <code>send</code>, which accepts an instance of <code>ApiRequest</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>trait</span> <span class=nc>ApiClient</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=n>send</span><span class=o>(</span><span class=n>request</span><span class=k>:</span> <span class=kt>ApiRequest</span><span class=o>)</span><span class=k>:</span> <span class=kt>Either</span><span class=o>[</span><span class=kt>ApiResponse</span>, <span class=kt>ApiResponse</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=client-library>Client Library</h3><p>For our client implementation, we use the Scala <a class=link href=https://github.com/softwaremill/sttp target=_blank rel=noopener>STTP</a> library, which will consume <code>ApiRequest</code> and generate an <code>ApiResponse</code>. Before implementing the client, we need to address two key components:</p><ol><li><strong>Authentication Wrapper</strong>: An implementation to handle various authentication mechanisms.</li><li><strong>Body Parser</strong>: To convert the response body into an appropriate <code>ApiBody</code> implementation.</li></ol><h3 id=authentication-wrapper>Authentication Wrapper</h3><p>The authentication wrapper for the STTP library will accept an STTP <code>Request</code> as a constructor argument and provide the necessary authentication logic.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>class</span> <span class=nc>SttpRequestProviderWrapper</span><span class=o>(</span><span class=k>var</span> <span class=n>request</span><span class=k>:</span> <span class=kt>sttp.client4.Request</span><span class=o>[</span><span class=kt>Either</span><span class=o>[</span><span class=kt>String</span>, <span class=kt>String</span><span class=o>]])</span> <span class=k>extends</span> <span class=nc>AuthRequestProvider</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>override</span> <span class=k>def</span> <span class=n>addBearerToken</span><span class=o>(</span><span class=n>token</span><span class=k>:</span> <span class=kt>String</span><span class=o>)</span><span class=k>:</span> <span class=kt>Unit</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>request</span> <span class=k>=</span> <span class=n>request</span><span class=o>.</span><span class=n>auth</span><span class=o>.</span><span class=n>bearer</span><span class=o>(</span><span class=n>token</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>override</span> <span class=k>def</span> <span class=n>addBasicAuth</span><span class=o>(</span><span class=n>username</span><span class=k>:</span> <span class=kt>String</span><span class=o>,</span> <span class=n>password</span><span class=k>:</span> <span class=kt>String</span><span class=o>)</span><span class=k>:</span> <span class=kt>Unit</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>request</span> <span class=k>=</span> <span class=n>request</span><span class=o>.</span><span class=n>auth</span><span class=o>.</span><span class=n>basic</span><span class=o>(</span><span class=n>username</span><span class=o>,</span> <span class=n>password</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>This wrapper can be extended to support additional authentication mechanisms as needed. The request (<code>sttp.client4.Request[Either[String, String]]</code>) will include the request body, allowing the wrapper to generate custom HTTP headers based on the body content.</p><h3 id=body-parser>Body Parser</h3><p>To transform the response body into one of our <code>ApiBody</code> implementations, we create a <code>BodyParser</code> interface. This interface will take the response content and headers, returning the appropriate body type.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>trait</span> <span class=nc>BodyParser</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=n>parseBody</span><span class=o>()</span><span class=k>:</span> <span class=kt>ApiBody</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=k>class</span> <span class=nc>BinaryParser</span><span class=o>(</span><span class=n>content</span><span class=k>:</span> <span class=kt>Array</span><span class=o>[</span><span class=kt>Byte</span><span class=o>],</span> <span class=n>contentType</span><span class=k>:</span> <span class=kt>String</span><span class=o>)</span> <span class=k>extends</span> <span class=nc>BodyParser</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>override</span> <span class=k>def</span> <span class=n>parseBody</span><span class=o>()</span><span class=k>:</span> <span class=kt>ApiBody</span> <span class=o>=</span> <span class=nc>BinaryBody</span><span class=o>(</span><span class=n>content</span><span class=o>,</span> <span class=n>contentType</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=k>class</span> <span class=nc>JsonParser</span><span class=o>(</span><span class=n>content</span><span class=k>:</span> <span class=kt>Array</span><span class=o>[</span><span class=kt>Byte</span><span class=o>])</span> <span class=k>extends</span> <span class=nc>BodyParser</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>override</span> <span class=k>def</span> <span class=n>parseBody</span><span class=o>()</span><span class=k>:</span> <span class=kt>ApiBody</span> <span class=o>=</span> <span class=nc>JsonBody</span><span class=o>(</span><span class=k>new</span> <span class=nc>String</span><span class=o>(</span><span class=n>content</span><span class=o>,</span> <span class=s>&#34;UTF-8&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=k>class</span> <span class=nc>XmlParser</span><span class=o>(</span><span class=n>content</span><span class=k>:</span> <span class=kt>Array</span><span class=o>[</span><span class=kt>Byte</span><span class=o>])</span> <span class=k>extends</span> <span class=nc>BodyParser</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>override</span> <span class=k>def</span> <span class=n>parseBody</span><span class=o>()</span><span class=k>:</span> <span class=kt>ApiBody</span> <span class=o>=</span> <span class=nc>XmlBody</span><span class=o>(</span><span class=k>new</span> <span class=nc>String</span><span class=o>(</span><span class=n>content</span><span class=o>,</span> <span class=s>&#34;UTF-8&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=k>class</span> <span class=nc>StringParser</span><span class=o>(</span><span class=n>content</span><span class=k>:</span> <span class=kt>Array</span><span class=o>[</span><span class=kt>Byte</span><span class=o>])</span> <span class=k>extends</span> <span class=nc>BodyParser</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>override</span> <span class=k>def</span> <span class=n>parseBody</span><span class=o>()</span><span class=k>:</span> <span class=kt>ApiBody</span> <span class=o>=</span> <span class=nc>StringBody</span><span class=o>(</span><span class=k>new</span> <span class=nc>String</span><span class=o>(</span><span class=n>content</span><span class=o>,</span> <span class=s>&#34;UTF-8&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=k>class</span> <span class=nc>FormUrlEncodedParser</span><span class=o>(</span><span class=n>content</span><span class=k>:</span> <span class=kt>Array</span><span class=o>[</span><span class=kt>Byte</span><span class=o>])</span> <span class=k>extends</span> <span class=nc>BodyParser</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>override</span> <span class=k>def</span> <span class=n>parseBody</span><span class=o>()</span><span class=k>:</span> <span class=kt>ApiBody</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=n>decodedContent</span> <span class=k>=</span> <span class=k>new</span> <span class=nc>String</span><span class=o>(</span><span class=n>content</span><span class=o>,</span> <span class=s>&#34;UTF-8&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=n>formData</span> <span class=k>=</span> <span class=n>decodedContent</span><span class=o>.</span><span class=n>split</span><span class=o>(</span><span class=s>&#34;&amp;&#34;</span><span class=o>).</span><span class=n>map</span> <span class=o>{</span> <span class=n>pair</span> <span class=k>=&gt;</span>
</span></span><span class=line><span class=cl>      <span class=k>val</span> <span class=nc>Array</span><span class=o>(</span><span class=n>key</span><span class=o>,</span> <span class=n>value</span><span class=o>)</span> <span class=k>=</span> <span class=n>pair</span><span class=o>.</span><span class=n>split</span><span class=o>(</span><span class=s>&#34;=&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=n>java</span><span class=o>.</span><span class=n>net</span><span class=o>.</span><span class=nc>URLDecoder</span><span class=o>.</span><span class=n>decode</span><span class=o>(</span><span class=n>key</span><span class=o>,</span> <span class=s>&#34;UTF-8&#34;</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=n>java</span><span class=o>.</span><span class=n>net</span><span class=o>.</span><span class=nc>URLDecoder</span><span class=o>.</span><span class=n>decode</span><span class=o>(</span><span class=n>value</span><span class=o>,</span> <span class=s>&#34;UTF-8&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>}.</span><span class=n>toMap</span>
</span></span><span class=line><span class=cl>    <span class=nc>FormUrlEncodedBody</span><span class=o>(</span><span class=n>formData</span><span class=o>)</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>A <a class=link href=https://sourcemaking.com/design_patterns/factory_method target=_blank rel=noopener>Factory design pattern</a> will be used to instantiate the appropriate <code>BodyParser</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>object</span> <span class=nc>BodyParser</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=n>getParser</span><span class=o>(</span><span class=n>content</span><span class=k>:</span> <span class=kt>Array</span><span class=o>[</span><span class=kt>Byte</span><span class=o>],</span> <span class=n>headers</span><span class=k>:</span> <span class=kt>Map</span><span class=o>[</span><span class=kt>String</span>, <span class=kt>String</span><span class=o>])</span><span class=k>:</span> <span class=kt>Option</span><span class=o>[</span><span class=kt>BodyParser</span><span class=o>]</span> <span class=k>=</span> <span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=o>(</span><span class=s>&#34;content-type&#34;</span><span class=o>)</span> <span class=k>match</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nc>Some</span><span class=o>(</span><span class=n>value</span><span class=o>)</span> <span class=k>=&gt;</span> <span class=n>value</span> <span class=k>match</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s>&#34;application/json&#34;</span> <span class=k>=&gt;</span> <span class=nc>Some</span><span class=o>(</span><span class=nc>JsonParser</span><span class=o>(</span><span class=n>content</span><span class=o>))</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s>&#34;application/xml&#34;</span> <span class=k>=&gt;</span> <span class=nc>Some</span><span class=o>(</span><span class=nc>XmlParser</span><span class=o>(</span><span class=n>content</span><span class=o>))</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s>&#34;application/x-www-form-urlencoded&#34;</span> <span class=k>=&gt;</span> <span class=nc>Some</span><span class=o>(</span><span class=nc>FormUrlEncodedParser</span><span class=o>(</span><span class=n>content</span><span class=o>))</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=k>_</span> <span class=k>=&gt;</span> <span class=nc>Some</span><span class=o>(</span><span class=nc>BinaryParser</span><span class=o>(</span><span class=n>content</span><span class=o>))</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nc>None</span> <span class=k>=&gt;</span> <span class=nc>None</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=client-implementation>Client Implementation</h3><p>With the building blocks in place, we implement the client. The client will use the <code>ApiRequest</code> properties (method, URL, headers) to construct the initial request, apply the body if present, and then handle authentication if required.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>protected</span><span class=o>[</span><span class=kt>api</span><span class=o>]</span> <span class=k>class</span> <span class=nc>SttpClient</span> <span class=k>extends</span> <span class=nc>ApiClient</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>private</span> <span class=k>val</span> <span class=n>backend</span> <span class=k>=</span> <span class=nc>HttpURLConnectionBackend</span><span class=o>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>override</span> <span class=k>def</span> <span class=n>send</span><span class=o>(</span><span class=n>request</span><span class=k>:</span> <span class=kt>ApiRequest</span><span class=o>)</span><span class=k>:</span> <span class=kt>Either</span><span class=o>[</span><span class=kt>ApiResponse</span>, <span class=kt>ApiResponse</span><span class=o>]</span> <span class=k>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>new</span> <span class=nc>URI</span><span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=o>).</span><span class=n>toURL</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>catch</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=n>e</span><span class=k>:</span> <span class=kt>URISyntaxException</span> <span class=o>=&gt;</span> <span class=k>return</span> <span class=nc>Left</span><span class=o>(</span><span class=nc>ApiResponse</span><span class=o>(</span><span class=mi>500</span><span class=o>,</span> <span class=nc>Some</span><span class=o>(</span><span class=nc>JsonBody</span><span class=o>(</span><span class=n>ujson</span><span class=o>.</span><span class=nc>Obj</span><span class=o>(</span><span class=s>&#34;message&#34;</span> <span class=o>-&gt;</span> <span class=n>e</span><span class=o>.</span><span class=n>getMessage</span><span class=o>).</span><span class=n>toString</span><span class=o>())),</span> <span class=nc>Map</span><span class=o>()))</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=n>e</span><span class=k>:</span> <span class=kt>IllegalArgumentException</span> <span class=o>=&gt;</span> <span class=k>return</span> <span class=nc>Left</span><span class=o>(</span><span class=nc>ApiResponse</span><span class=o>(</span><span class=mi>500</span><span class=o>,</span> <span class=nc>Some</span><span class=o>(</span><span class=nc>JsonBody</span><span class=o>(</span><span class=n>ujson</span><span class=o>.</span><span class=nc>Obj</span><span class=o>(</span><span class=s>&#34;message&#34;</span> <span class=o>-&gt;</span> <span class=n>e</span><span class=o>.</span><span class=n>getMessage</span><span class=o>).</span><span class=n>toString</span><span class=o>())),</span> <span class=nc>Map</span><span class=o>()))</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=n>sttpRequest</span> <span class=k>=</span> <span class=n>sttp</span><span class=o>.</span><span class=n>client4</span><span class=o>.</span><span class=n>basicRequest</span><span class=o>.</span><span class=n>method</span><span class=o>(</span><span class=n>sttp</span><span class=o>.</span><span class=n>model</span><span class=o>.</span><span class=nc>Method</span><span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=n>method</span><span class=o>.</span><span class=n>toString</span><span class=o>),</span> <span class=n>uri</span><span class=s>&#34;${request.url}&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>request</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>foreach</span> <span class=o>{</span> <span class=k>case</span> <span class=o>(</span><span class=n>key</span><span class=o>,</span> <span class=n>value</span><span class=o>)</span> <span class=k>=&gt;</span>
</span></span><span class=line><span class=cl>      <span class=n>sttpRequest</span> <span class=k>=</span> <span class=n>sttpRequest</span><span class=o>.</span><span class=n>header</span><span class=o>(</span><span class=n>key</span><span class=o>,</span> <span class=n>value</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>request</span><span class=o>.</span><span class=n>body</span><span class=o>.</span><span class=n>foreach</span> <span class=o>{</span> <span class=n>body</span> <span class=k>=&gt;</span>
</span></span><span class=line><span class=cl>      <span class=n>sttpRequest</span> <span class=k>=</span> <span class=n>sttpRequest</span><span class=o>.</span><span class=n>body</span><span class=o>(</span><span class=n>body</span><span class=o>.</span><span class=n>content</span><span class=o>).</span><span class=n>contentType</span><span class=o>(</span><span class=n>body</span><span class=o>.</span><span class=n>contentType</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=n>authRequest</span> <span class=k>=</span> <span class=k>new</span> <span class=nc>SttpRequestProviderWrapper</span><span class=o>(</span><span class=n>sttpRequest</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=n>request</span><span class=o>.</span><span class=n>authentication</span><span class=o>.</span><span class=n>foreach</span><span class=o>(</span><span class=k>_</span><span class=o>.</span><span class=n>applyTo</span><span class=o>(</span><span class=n>authRequest</span><span class=o>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sttpRequest</span> <span class=k>=</span> <span class=n>authRequest</span><span class=o>.</span><span class=n>request</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=n>response</span> <span class=k>=</span> <span class=n>sttpRequest</span><span class=o>.</span><span class=n>response</span><span class=o>(</span><span class=n>asByteArray</span><span class=o>).</span><span class=n>send</span><span class=o>(</span><span class=n>backend</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=n>headers</span> <span class=k>=</span> <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>map</span><span class=o>(</span><span class=n>h</span> <span class=k>=&gt;</span> <span class=n>h</span><span class=o>.</span><span class=n>name</span> <span class=o>-&gt;</span> <span class=n>h</span><span class=o>.</span><span class=n>value</span><span class=o>).</span><span class=n>toMap</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=n>responseEntity</span> <span class=k>=</span> <span class=nc>ApiResponse</span><span class=o>(</span>
</span></span><span class=line><span class=cl>      <span class=n>response</span><span class=o>.</span><span class=n>code</span><span class=o>.</span><span class=n>code</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>response</span><span class=o>.</span><span class=n>body</span> <span class=k>match</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nc>Left</span><span class=o>(</span><span class=n>error</span><span class=o>)</span> <span class=k>=&gt;</span> <span class=nc>BodyParser</span><span class=o>.</span><span class=n>getParser</span><span class=o>(</span><span class=n>error</span><span class=o>.</span><span class=n>getBytes</span><span class=o>(</span><span class=s>&#34;UTF-8&#34;</span><span class=o>),</span> <span class=n>headers</span><span class=o>)</span> <span class=k>match</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>          <span class=k>case</span> <span class=nc>Some</span><span class=o>(</span><span class=n>value</span><span class=o>)</span> <span class=k>=&gt;</span> <span class=nc>Some</span><span class=o>(</span><span class=n>value</span><span class=o>.</span><span class=n>parseBody</span><span class=o>())</span>
</span></span><span class=line><span class=cl>          <span class=k>case</span> <span class=nc>None</span> <span class=k>=&gt;</span> <span class=nc>None</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nc>Right</span><span class=o>(</span><span class=n>value</span><span class=o>)</span> <span class=k>=&gt;</span> <span class=nc>Some</span><span class=o>(</span><span class=nc>BodyParser</span><span class=o>.</span><span class=n>getParser</span><span class=o>(</span><span class=n>value</span><span class=o>,</span> <span class=n>headers</span><span class=o>).</span><span class=n>get</span><span class=o>.</span><span class=n>parseBody</span><span class=o>())</span>
</span></span><span class=line><span class=cl>      <span class=o>},</span>
</span></span><span class=line><span class=cl>      <span class=n>headers</span>
</span></span><span class=line><span class=cl>    <span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>response</span><span class=o>.</span><span class=n>code</span><span class=o>.</span><span class=n>isClientError</span> <span class=o>||</span> <span class=n>response</span><span class=o>.</span><span class=n>code</span><span class=o>.</span><span class=n>isServerError</span><span class=o>)</span> <span class=nc>Left</span><span class=o>(</span><span class=n>responseEntity</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=nc>Right</span><span class=o>(</span><span class=n>responseEntity</span><span class=o>)</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=ensure-stability-of-api-package>Ensure stability of API package</h2><p>A primary motivation for this rewrite is to minimize the impact of a library going end-of-life (EOL) in the future. If the STTP library becomes unsupported, we should only need to make a single line change in our code, ensuring the rest of the classes remain unaffected.</p><p>In the <code>SttpClient</code> implementation, the access modifier is set to <code>protected[api]</code>. This restricts access to within the <code>api</code> package, preventing direct usage outside. To facilitate client access, we define an <code>ApiClient</code> object in the same file as the <code>ApiClient</code> trait. This object includes an <code>apply()</code> method that creates a new instance of <code>SttpClient</code>, leveraging its position within the <code>api</code> subpackage.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>object</span> <span class=nc>ApiClient</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=n>apply</span><span class=o>()</span> <span class=k>=</span> <span class=k>new</span> <span class=nc>SttpClient</span><span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>In the event that the STTP library goes EOL, we would need to:</p><ol><li>Implement a new authentication wrapper for the replacement library.</li><li>Implement the new library&rsquo;s client (similar to <code>SttpClient</code>).</li><li>Update the <code>apply()</code> method in <code>ApiClient</code> to return an instance of the new client. This single-line change ensures that no other classes are impacted by the transition.</li></ol><h2 id=using-the-client>Using the client</h2><p>With the foundational components in place, we can now use the <code>ApiClient</code> to make an HTTP call. Here&rsquo;s an example of how to perform an API call using the implemented code:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>val</span> <span class=n>request</span> <span class=k>=</span> <span class=nc>ApiRequestBuilder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>  <span class=o>.</span><span class=n>withUrl</span><span class=o>(</span><span class=n>url</span><span class=o>)</span>
</span></span><span class=line><span class=cl>  <span class=o>.</span><span class=n>withMethod</span><span class=o>(</span><span class=nc>POST</span><span class=o>)</span>        <span class=c1>// Refers to the case object POST created above
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=o>.</span><span class=n>withAuthentication</span><span class=o>(</span><span class=nc>TokenAuth</span><span class=o>(</span><span class=n>token</span><span class=o>))</span>
</span></span><span class=line><span class=cl>  <span class=o>.</span><span class=n>withBody</span><span class=o>(</span><span class=nc>JsonBody</span><span class=o>(</span><span class=s>&#34;&#34;&#34;{&#34;key&#34;:&#34;value&#34;}&#34;&#34;&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>  <span class=o>.</span><span class=n>build</span><span class=o>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nc>ApiClient</span><span class=o>().</span><span class=n>send</span><span class=o>(</span><span class=n>request</span><span class=o>)</span> <span class=k>match</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>case</span> <span class=nc>Left</span><span class=o>(</span><span class=n>value</span><span class=o>)</span> <span class=k>=&gt;</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=nc>Exception</span><span class=o>(</span><span class=n>value</span><span class=o>.</span><span class=n>body</span><span class=o>.</span><span class=n>get</span><span class=o>)</span>
</span></span><span class=line><span class=cl>  <span class=k>case</span> <span class=nc>Right</span><span class=o>(</span><span class=nc>ApiResponse</span><span class=o>(</span><span class=k>_</span><span class=o>,</span> <span class=n>body</span><span class=o>,</span> <span class=k>_</span><span class=o>))</span> <span class=k>=&gt;</span>
</span></span><span class=line><span class=cl>    <span class=n>println</span><span class=o>(</span><span class=n>body</span><span class=o>.</span><span class=n>get</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=n>println</span><span class=o>(</span><span class=s>&#34;API Call successful&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Note the use of <code>ApiClient()</code> to initiate the HTTP call. In Scala, <code>ApiClient()</code> is syntactic sugar that the compiler interprets as a call to the <code>ApiClient.apply()</code> method.</p><h2 id=adherence-to-solid-principles>Adherence to SOLID Principles</h2><p><a class=link href=https://en.wikipedia.org/wiki/SOLID target=_blank rel=noopener>SOLID</a> is a set of five principles of Object-Oriented class design. They are a set of rules and best practices to follow while designing a class structure. These five principles help us understand the need for certain design patterns and software architecture in general. I always strive to adhere to these principles whenever I&rsquo;m developing software, and we will now have a look at how the code above adheres to the SOLID Principles.</p><h3 id=single-responsibility-principle-srp><strong>S</strong>ingle Responsibility Principle (SRP)</h3><p>A class should have one, and only one, reason to change. This principle promotes the separation of concerns within a system:</p><ul><li>Our <code>HttpRequestBuilder</code> is solely responsible for building <code>HttpRequest</code> objects. It encapsulates the construction logic and provides an interface for setting request properties.</li><li>The <code>BodyParser</code> isolates the logic for parsing different types of response bodies based on the content type, keeping this concern separate from other parts of the system</li><li>Our <code>SttpClient</code> implementation handles the responsibility of sending HTTP requests and processing responses. It doesn&rsquo;t concern itself with the construction of requests or parsing of response bodies, which are handled by other classes.</li><li><code>ApiResponse</code> encapsulates the response data, separating it from the request logic and the client implementation.</li><li><code>ApiAuth</code> and its various subclasses have a single responsibility to apply a specific authentication mechanism.</li></ul><h3 id=openclosed-principle-ocp><strong>O</strong>pen/Closed Principle (OCP)</h3><p>Software entities should be open for extension but closed for modification. This means you can extend the behavior of a class without modifying its source code:</p><ul><li>The <code>Body</code> trait and its subclasses allow for easy addition of new body types without altering existing code. For example, adding a new <code>CsvBody</code> would involve creating a new case class that extends <code>Body</code>.</li><li>New implementations of <code>ApiClient</code> can be created (e.g., <code>JavaApiClient</code>, <code>Http4sApiClient</code>) without modifying the existing <code>SttpClient</code>. Each new client implementation can provide its own logic for sending requests.</li><li>New authentication methods can be added by creating new classes that implement the <code>Authentication</code> trait.</li></ul><h3 id=liskov-substitution-principle-lsp><strong>L</strong>iskov Substitution Principle (LSP)</h3><p>Objects of a superclass should be replaceable with objects of a subclass without affecting the correctness of the program:</p><ul><li>Anywhere a <code>Body</code> is expected, any of its subclasses (<code>JsonBody</code>, <code>XmlBody</code>, etc.) can be used interchangeably.</li><li>The system can use <code>TokenAuthentication</code> or <code>BasicAuthentication</code> interchangeably wherever <code>Authentication</code> is expected, ensuring the <code>applyTo</code> method works correctly for any subclass.</li></ul><h3 id=interface-segregation-principle-isp><strong>I</strong>nterface Segregation Principle (ISP)</h3><p>No client should be forced to depend on methods it does not use. This principle advocates for smaller, more specific interfaces:</p><ul><li><code>ApiAuth</code> <strong>Interface</strong>: This interface is specifically for adding authentication to a request and does not include other unrelated methods. It ensures that only relevant methods are exposed to classes that implement this interface.</li><li><code>ApiClient</code> <strong>Interface</strong>: Defines a minimal interface for sending HTTP requests. It does not force implementing classes to expose unnecessary methods.</li></ul><h3 id=dependency-inversion-principle-dip><strong>D</strong>ependency Inversion Principle (DIP)</h3><p>High-level modules should not depend on low-level modules. Both should depend on abstractions. Abstractions should not depend on details. Details should depend on abstractions:</p><ul><li><code>ApiClient</code> <strong>Interface</strong>: The high-level code (such as a service using the HTTP client) depends on the <code>ApiClient</code> abstraction, not on specific implementations like <code>SttpClient</code>.</li><li><strong>Dependency on Abstractions</strong>: The system uses the <code>ApiAuth</code>, <code>ApiBody</code>, and <code>ApiClient</code> abstractions rather than concrete implementations, making it easy to swap out implementations as needed.</li></ul><h2 id=conclusion>Conclusion</h2><p>The goal was to modernize our HTTP client classes, moving from a rigid, outdated pieces to a flexible, modular architecture. By focusing on a clean separation of concerns and employing design patterns like Builder, Factory and Singleton, we created a robust framework that enhances maintainability and scalability.</p><p>Key features include a modular request builder, an extensible authentication wrapper, and a consistent handling of API responses. The new design ensures easy adaptability to future changes, such as switching out libraries or updating security protocols, with minimal impact on the overall system.</p><p>This streamlined, adaptable architecture not only addresses previous limitations but also positions our product for future growth and technological advancements.</p><p>Code used inside this post is also available inside my <a class=link href=https://github.com/Sparker0i/API-Scala-with-SOLID-Principles target=_blank rel=noopener>GitHub repo</a>.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/solid-principles/>SOLID Principles</a>
<a href=/tags/clean-code/>Clean Code</a>
<a href=/tags/refactor/>Refactor</a>
<a href=/tags/software-architecture/>Software Architecture</a></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on Aug 06, 2024 22:02 UTC</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=[".main-article",".widget--toc"];e.forEach(e=>{const t=document.querySelector(e);t&&renderMathInElement(t,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/identify-and-refactor-code-smells-for-better-code-quality/><div class=article-image><img src=/identify-and-refactor-code-smells-for-better-code-quality/6821a6985006bd988f7f9344.ecccd184c3781dae6b5735dc7f51efec_hu_6fa1dea44bdfc8c.png width=250 height=150 loading=lazy alt="Featured image of post How to Identify and Refactor Code Smells for Better Code Quality" data-key=identify-and-refactor-code-smells-for-better-code-quality data-hash="md5-7MzRhMN4Ha5rVzXcf1Hv7A=="></div><div class=article-details><h2 class=article-title>How to Identify and Refactor Code Smells for Better Code Quality</h2></div></a></article><article class=has-image><a href=/self-contained-systems-alternate-to-monolith-microservices/><div class=article-image><img src=/self-contained-systems-alternate-to-monolith-microservices/scs.f906efea215a2f8da82e9185dd5c7381_hu_762f9bce6b333f52.jpg width=250 height=150 loading=lazy alt="Featured image of post Self Contained Systems: Beyond the Monolith vs Microservices debate" data-key=self-contained-systems-alternate-to-monolith-microservices data-hash="md5-+Qbv6iFaL42oLpGF3VxzgQ=="></div><div class=article-details><h2 class=article-title>Self Contained Systems: Beyond the Monolith vs Microservices debate</h2></div></a></article><article class=has-image><a href=/why-every-developer-should-care-about-design-patterns/><div class=article-image><img src=/why-every-developer-should-care-about-design-patterns/67cbf99efca581965cde6fca.4fa4ac1d9252fdd6668e283c5b9b12f0_hu_88b5b38ff3f0d92e.png width=250 height=150 loading=lazy alt="Featured image of post Why Every Developer Should Care About Design Patterns: A Deep Dive" data-key=why-every-developer-should-care-about-design-patterns data-hash="md5-T6SsHZJS/dZmjig8W5sS8A=="></div><div class=article-details><h2 class=article-title>Why Every Developer Should Care About Design Patterns: A Deep Dive</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=Sparker0i/Sparker0i.github.io data-repo-id=R_kgDOPDIt_w data-category=Announcements data-category-id=DIC_kwDOPDIt_84CsLyO data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=1 data-input-position=top data-theme=preferred_color_scheme data-lang=en data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"preferred_color_scheme":"preferred_color_scheme")}})()</script><footer class=site-footer><section class=copyright>&copy;
2017 -
2026 Sparker0i's Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.34.1>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>