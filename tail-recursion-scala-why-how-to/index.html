<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Read my blog post to know more about the advantages of tail recursion, and how do you use it in Scala."><title>Tail Recursion: Why and How-to Use in Scala</title><link rel=canonical href=https://blog.sparker0i.me/tail-recursion-scala-why-how-to/><link rel=stylesheet href=/scss/style.min.86591c898bd806857815fbb8c47e8d3fed97c133b78e83d9bfc27b164dd0aa2b.css><meta property='og:title' content="Tail Recursion: Why and How-to Use in Scala"><meta property='og:description' content="Read my blog post to know more about the advantages of tail recursion, and how do you use it in Scala."><meta property='og:url' content='https://blog.sparker0i.me/tail-recursion-scala-why-how-to/'><meta property='og:site_name' content="Sparker0i's Blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Scala'><meta property='article:published_time' content='2020-05-07T19:45:00+00:00'><meta property='article:modified_time' content='2024-04-14T17:41:12+00:00'><meta property='og:image' content='https://blog.sparker0i.me/tail-recursion-scala-why-how-to/661c083cdbf837e5981954ca.png'><meta name=twitter:title content="Tail Recursion: Why and How-to Use in Scala"><meta name=twitter:description content="Read my blog post to know more about the advantages of tail recursion, and how do you use it in Scala."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://blog.sparker0i.me/tail-recursion-scala-why-how-to/661c083cdbf837e5981954ca.png'><link rel="shortcut icon" href=/favicon.png><script async src="https://www.googletagmanager.com/gtag/js?id=G-B20G7JM0X8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-B20G7JM0X8")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/sparker0i_hu_693dc16bb266ace6.jpg width=300 height=301 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ðŸ˜Ž</span></figure><div class=site-meta><h1 class=site-name><a href=/>Sparker0i's Blog</a></h1><h2 class=site-description>I blog about coding, tech, AI, cricket and other personal hobbies too.</h2></div></header><ol class=menu-social><li><a href=https://github.com/Sparker0i target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/sparker0i target=_blank title=LinkedIn rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-linkedin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 10-4 0"/><path d="M3 7a4 4 0 014-4h10a4 4 0 014 4v10a4 4 0 01-4 4H7a4 4 0 01-4-4z"/></svg></a></li><li><a href=https://steamcommunity.com/id/Sparker0i target=_blank title=Steam rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-steam"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16.5 5a4.5 4.5.0 11-.653 8.953L11.5 16.962V17a3 3 0 01-2.824 3H8.5a3 3 0 01-2.94-2.402L3 16.5V13l3.51 1.755a2.989 2.989.0 012.834-.635l2.727-3.818A4.5 4.5.0 0116.5 5z"/><circle cx="16.5" cy="9.5" r="1" fill="currentColor"/></svg></a></li><li><a href=https://x.com/Sparker0i target=_blank title=Twitter rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-x"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><a href=#tail-recursion>Tail Recursion</a></li><li><a href=#tail-recursion-in-scala>Tail Recursion in Scala</a></li><li><a href=#convert-a-recursive-function-to-a-tail-recursive-function>Convert a recursive function to a tail-recursive function</a></li><li><a href=#conclusion>CONCLUSION</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/tail-recursion-scala-why-how-to/><img src=/tail-recursion-scala-why-how-to/661c083cdbf837e5981954ca_hu_9c2b3b10abb71bd4.png srcset="/tail-recursion-scala-why-how-to/661c083cdbf837e5981954ca_hu_9c2b3b10abb71bd4.png 800w, /tail-recursion-scala-why-how-to/661c083cdbf837e5981954ca_hu_b4daf3bdf88fd0b3.png 1600w" width=800 height=447 loading=lazy alt="Featured image of post Tail Recursion: Why and How-to Use in Scala"></a></div><div class=article-details><header class=article-category><a href=/categories/scala/ style=background-color:#811f1f;color:#fff>Scala</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/tail-recursion-scala-why-how-to/>Tail Recursion: Why and How-to Use in Scala</a></h2><h3 class=article-subtitle>Read my blog post to know more about the advantages of tail recursion, and how do you use it in Scala.</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2020-05-07T19:45:00Z>May 07, 2020</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>6 minute read</time></div></footer></div></header><section class=article-content><p>In the below code, I have written a recursive function that multiplies all the natural numbers up to the number passed as a parameter to the function. As you might have guessed, this is nothing but computing the factorial of a particular number.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>def</span> <span class=n>recursiveProd</span><span class=o>(</span><span class=n>x</span><span class=k>:</span> <span class=kt>Int</span><span class=o>)</span><span class=k>:</span> <span class=kt>BigInt</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>x</span> <span class=o>&lt;=</span> <span class=mi>1</span><span class=o>)</span> 
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> 
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>x</span> <span class=o>*</span> <span class=n>recursiveProd</span><span class=o>(</span><span class=n>x</span><span class=o>-</span><span class=mi>1</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Recursive Factorial Program</p><p>Let us see how this function is being executed as a whole assuming we executed <code>recursiveProd(5)</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=n>recursiveProd</span><span class=o>(</span><span class=mi>5</span><span class=o>)</span>  
</span></span><span class=line><span class=cl><span class=mi>5</span> <span class=o>*</span> <span class=n>recursiveProd</span><span class=o>(</span><span class=mi>4</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>    <span class=o>(</span><span class=mi>4</span> <span class=o>*</span> <span class=n>recursiveProd</span><span class=o>(</span><span class=mi>3</span><span class=o>))</span>  
</span></span><span class=line><span class=cl>         <span class=o>(</span><span class=mi>3</span> <span class=o>*</span> <span class=n>recursiveProd</span><span class=o>(</span><span class=mi>2</span><span class=o>))</span>
</span></span><span class=line><span class=cl>              <span class=o>(</span><span class=mi>2</span> <span class=o>*</span> <span class=n>recursiveProd</span><span class=o>(</span><span class=mi>1</span><span class=o>))</span>  
</span></span><span class=line><span class=cl>                   <span class=mi>1</span> 
</span></span><span class=line><span class=cl><span class=mi>120</span>
</span></span></code></pre></td></tr></table></div></div><p>From above, each recursive call has to be completed first before the actual work of calculating the product begins. Each recursive call saves the current state, and proceeds to call the next recursive function. This happens repeatedly until the base case is reached. In between, you might also encounter the Stack Overflow error.</p><p>So, in each step you execute 2 steps, retrieve the current value and the value from the next stage (as a recursive call), and then multiply them. Subsequent recursive calls will do the same. If you can visualize this correctly, you will notice this recursive call was completed in <strong>14 computations</strong> (4 multiplications, 5 recursive calls, 5 returning values), with computations happening in each step.</p><h3 id=tail-recursion>Tail Recursion</h3><p>Now letâ€™s consider Tail Recursion. In Tail Recursion, all the processing related to the recursive function must finish before the recursive call takes place. This means that <strong>if a function is tail-recursive, the last action is a call to itself</strong>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>def</span> <span class=n>tailRecursiveProd</span><span class=o>(</span><span class=n>x</span><span class=k>:</span> <span class=kt>Int</span><span class=o>,</span> <span class=n>currentTotal</span><span class=k>:</span> <span class=kt>BigInt</span><span class=o>)</span><span class=k>:</span> <span class=kt>BigInt</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>x</span> <span class=o>&lt;=</span> <span class=mi>1</span><span class=o>)</span> 
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>currentTotal</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> 
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>tailRecursiveProd</span><span class=o>(</span><span class=n>x</span> <span class=o>-</span> <span class=mi>1</span><span class=o>,</span> <span class=n>currentTotal</span> <span class=o>*</span> <span class=n>x</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>In this scenario, despite there being a multiplication operation, it happens when the argument is passed to the next recursive call. In short, we send the current state of the recursive call to the next state, and the same process will be repeated until the base case is reached. Let us see how this is executed:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=n>recursiveProd</span><span class=o>(</span><span class=mi>5</span><span class=o>,</span><span class=mi>1</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=n>recursiveProd</span><span class=o>(</span><span class=mi>4</span><span class=o>,</span><span class=mi>5</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=n>recursiveProd</span><span class=o>(</span><span class=mi>3</span><span class=o>,</span><span class=mi>20</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=n>recursiveProd</span><span class=o>(</span><span class=mi>2</span><span class=o>,</span><span class=mi>60</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=n>recursiveProd</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span><span class=mi>120</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=mi>120</span>
</span></span></code></pre></td></tr></table></div></div><p>In this way, we can save up additional stack memory which would&rsquo;ve otherwise be wasted to compute the multiplications at every return step. Thus, this implementation only takes 10 computations (5 recursive calls, 5 returning values). This is equivalent of you using a loop to process the factorial.</p><p>Thus, you should always try and convert your recursive function into a tail recursive function wherever possible.</p><h3 id=tail-recursion-in-scala>Tail Recursion in Scala</h3><p>One good thing about Scala is that it automatically recognizes two types of tail-recursive methods automatically and optimizes them. These types are:</p><ol><li>Methods within an <code>object</code></li><li>Methods defined as <code>final</code></li></ol><p>Sadly, if you write a non-<code>final</code> tail-recursive function inside a <code>class</code>, or even a <code>case class</code>, it will not be automatically optimized by the Scala Compiler because a <code>class</code> can be <code>extend</code>ed and these methods can be <code>override</code>n. Consider my code given below:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>object</span> <span class=nc>Bm</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=n>nTailRecursion</span><span class=o>(</span><span class=n>n</span><span class=k>:</span> <span class=kt>Int</span><span class=o>)</span><span class=k>:</span> <span class=kt>Int</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>n</span> <span class=o>==</span> <span class=mi>0</span><span class=o>)</span> <span class=mi>1</span> <span class=k>else</span> <span class=n>nTailRecursion</span><span class=o>(</span><span class=n>n</span> <span class=o>-</span> <span class=mi>1</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=k>class</span> <span class=nc>Bm</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=n>tailRecursion</span><span class=o>(</span><span class=n>n</span><span class=k>:</span> <span class=kt>Int</span><span class=o>)</span><span class=k>:</span> <span class=kt>Int</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>n</span> <span class=o>==</span> <span class=mi>0</span><span class=o>)</span> <span class=mi>1</span> <span class=k>else</span> <span class=n>tailRecursion</span><span class=o>(</span><span class=n>n</span> <span class=o>-</span> <span class=mi>1</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>final</span> <span class=k>def</span> <span class=n>tailsRecursion</span><span class=o>(</span><span class=n>n</span><span class=k>:</span> <span class=kt>Int</span><span class=o>)</span><span class=k>:</span> <span class=kt>Int</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>n</span> <span class=o>==</span> <span class=mi>0</span><span class=o>)</span> <span class=mi>1</span> <span class=k>else</span> <span class=n>tailsRecursion</span><span class=o>(</span><span class=n>n</span> <span class=o>-</span> <span class=mi>1</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>You can see that all these functions are doing the same task. Now:</p><ol><li>Start a Scala REPL (Install Scala on your machine, then type <code>scala</code> on your command line/terminal and press Enter)</li><li>Type <code>:paste</code> and press Enter</li><li>Paste the code snippet above</li><li>Press <code>Ctrl-D</code> to exit the paste mode</li></ol><p>Then, try running <code>Bm.nTailRecursion(60000)</code> and <code>Bm().tailsRecursion(60000)</code>. I&rsquo;ve tried that on my current laptop with an Intel i7-8750H processor and 16GB RAM, and both of them worked fine. Now, when you try running <code>Bm().tailRecursion(60000)</code>, you see a familiar <code>java.lang.StackOverflowError</code> which usually occurs with recursive function:</p><p><img src=/tail-recursion-scala-why-how-to/661c083cdbf837e5981954ca_fb49ff24-b09e-4750-a4a3-655c2362f5bd.png width=736 height=378 srcset="/tail-recursion-scala-why-how-to/661c083cdbf837e5981954ca_fb49ff24-b09e-4750-a4a3-655c2362f5bd_hu_6b59f2017af88916.png 480w, /tail-recursion-scala-why-how-to/661c083cdbf837e5981954ca_fb49ff24-b09e-4750-a4a3-655c2362f5bd_hu_aa147e143e9b05b8.png 1024w" loading=lazy class=gallery-image data-flex-grow=194 data-flex-basis=467px></p><p>Sure, you could play around with the JVM memory limits and possibly execute this function properly. You must always remember that memory is an intensive resource, and non-availability of memory might crash other programs, as well as your current program.</p><p>Fortunately, Scala provides the <code>@tailrec</code> annotation to denote that a method is actually tail-recursive. First you will have to import <code>scala.annotation.tailrec</code> and place that annotation before the function you want to mark as tail-recursive. Place this annotation before <code>tailRecursion()</code> inside the <code>case class</code> and now copy-paste inside the REPL and try again. This time it won&rsquo;t throw the dreaded <code>java.lang.StackOverflowError</code> Exception.</p><h3 id=convert-a-recursive-function-to-a-tail-recursive-function>Convert a recursive function to a tail-recursive function</h3><p>In some cases, you might want to retain the original method&rsquo;s signature (eg. Factorial). This can be done using the following steps:</p><ol><li>Create a second function</li></ol><p>Within the <code>recursiveProd</code> as defined in the first code piece above, we now define another method, <code>cumulativeRecursion</code> with two parameters: <code>n</code>, our number and <code>res</code>, the result of recursion. We retain the algorithm of the first method as is. At this point our new method looks like:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>def</span> <span class=n>recursiveProd</span><span class=o>(</span><span class=n>n</span><span class=k>:</span> <span class=kt>Int</span><span class=o>)</span><span class=k>:</span> <span class=kt>Int</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=n>cumulativeRecursion</span><span class=o>(</span><span class=n>n</span><span class=k>:</span> <span class=kt>Int</span><span class=o>,</span> <span class=n>res</span><span class=k>:</span> <span class=kt>Int</span><span class=o>)</span><span class=k>:</span> <span class=kt>Int</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>n</span> <span class=o>&lt;=</span> <span class=mi>1</span><span class=o>)</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=n>n</span> <span class=o>*</span> <span class=n>recursiveProd</span><span class=o>(</span><span class=n>n</span> <span class=o>-</span> <span class=mi>1</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>Modify the second method&rsquo;s algorithm</li></ol><p>We will now utilize the accumulator we&rsquo;ve just created, <code>res</code> and modify the function such that the base case returns the accumulated value and the other case recursively calls the new method again:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>def</span> <span class=n>recursiveProd</span><span class=o>(</span><span class=n>n</span><span class=k>:</span> <span class=kt>Int</span><span class=o>)</span><span class=k>:</span> <span class=kt>Int</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=n>cumulativeRecursion</span><span class=o>(</span><span class=n>n</span><span class=k>:</span> <span class=kt>Int</span><span class=o>,</span> <span class=n>res</span><span class=k>:</span> <span class=kt>Int</span><span class=o>)</span><span class=k>:</span> <span class=kt>Int</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>n</span> <span class=o>&lt;=</span> <span class=mi>1</span><span class=o>)</span> <span class=n>res</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=n>cumulativeRecursion</span><span class=o>(</span><span class=n>n</span> <span class=o>-</span> <span class=mi>1</span><span class=o>,</span> <span class=n>res</span> <span class=o>*</span> <span class=n>n</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><ol start=3><li>Annotate the second method and call the new method</li></ol><p>We will now annotate our new method with <code>@tailrec</code> as shown earlier and we will now call this method from our original method:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>def</span> <span class=n>recursiveProd</span><span class=o>(</span><span class=n>n</span><span class=k>:</span> <span class=kt>Int</span><span class=o>)</span><span class=k>:</span> <span class=kt>Int</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@tailrec</span> <span class=k>def</span> <span class=n>cumulativeRecursion</span><span class=o>(</span><span class=n>n</span><span class=k>:</span> <span class=kt>Int</span><span class=o>,</span> <span class=n>res</span><span class=k>:</span> <span class=kt>Int</span><span class=o>)</span><span class=k>:</span> <span class=kt>Int</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>n</span> <span class=o>&lt;=</span> <span class=mi>1</span><span class=o>)</span> <span class=n>res</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=n>cumulativeRecursion</span><span class=o>(</span><span class=n>n</span> <span class=o>-</span> <span class=mi>1</span><span class=o>,</span> <span class=n>res</span> <span class=o>*</span> <span class=n>n</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=n>cumulativeRecursion</span><span class=o>(</span><span class=n>n</span><span class=o>,</span> <span class=mi>1</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Hence, you retain your method&rsquo;s original signature, as well as converted it into a tail-recursive call (Though this will add 1 extra stack call to the new function).</p><h3 id=conclusion>CONCLUSION</h3><p>In this post, I have:</p><ul><li>Defined Tail Recursion</li><li>Introduced <code>@tailrec</code> annotation</li><li>Shown a formula to convert a recursive function into a tail-recursive one.</li></ul><p>Hope you have enjoyed this post. Do follow my profiles on <a class=link href="https://www.linkedin.com/in/sparker0i?ref=localhost" target=_blank rel=noopener>LinkedIn</a>, <a class=link href="https://github.com/Sparker0i?ref=localhost" target=_blank rel=noopener>GitHub</a> and <a class=link href="https://twiiter.com/Sparker0i?ref=localhost" target=_blank rel=noopener>Twitter</a>.</p><p>Ciao, until the next post.</p><p>Reference: <a class=link href="https://alvinalexander.com/scala/fp-book/tail-recursive-algorithms/?ref=localhost" target=_blank rel=noopener>Tail Recursive Algorithms</a></p></section><footer class=article-footer><section class=article-tags><a href=/tags/scala/>Scala</a></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on Apr 14, 2024 17:41 UTC</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=[".main-article",".widget--toc"];e.forEach(e=>{const t=document.querySelector(e);t&&renderMathInElement(t,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/scala-add-new-functions-to-existing-class/><div class=article-image><img src=/scala-add-new-functions-to-existing-class/661c08479bb70e9dac2bfee3.7b6e47ac2dbde3e7e157720c71614fc6_hu_7e6d732d9d5d00e5.png width=250 height=150 loading=lazy alt="Featured image of post Add new functions to existing classes the Scala way" data-key=scala-add-new-functions-to-existing-class data-hash="md5-e25HrC294+fhV3IMcWFPxg=="></div><div class=article-details><h2 class=article-title>Add new functions to existing classes the Scala way</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=Sparker0i/Sparker0i.github.io data-repo-id=R_kgDOPDIt_w data-category=Announcements data-category-id=DIC_kwDOPDIt_84CsLyO data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=1 data-input-position=top data-theme=preferred_color_scheme data-lang=en data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"preferred_color_scheme":"preferred_color_scheme")}})()</script><footer class=site-footer><section class=copyright>&copy;
2017 -
2026 Sparker0i's Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.34.1>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>